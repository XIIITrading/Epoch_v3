================================================================================
MODULE 10: RESULTS ANALYSIS - TECHNICAL DOCUMENTATION
XIII Trading LLC | v1.2 | December 2025
================================================================================

MODULE 10 OVERVIEW
------------------
Module 10 is a Python-based analysis system that reads backtest results from 
Excel (epoch_v1.xlsm) and exports them for AI-assisted analysis.

FILES:
- config.py           - Configuration and column mappings
- excel_reader.py     - Reads data from Excel worksheets
- daily_exporter.py   - Builds full JSON export with statistics
- summary_exporter.py - Generates condensed summary for Claude chat
- history_manager.py  - SQLite database for historical tracking
- analysis_runner.py  - Main entry point

RUN COMMANDS:
  python analysis_runner.py --skip-polygon --copy    # Standard daily run
  python analysis_runner.py --date 2025-12-10        # Specific date
  python analysis_runner.py --report                 # Historical summary
  python analysis_runner.py --copy-json              # Copy full JSON (large)

OPTIONS:
  --skip-polygon, -s  Skip Polygon API calls (faster)
  --copy, -c          Copy daily summary to clipboard (for Claude)
  --copy-json         Copy full JSON to clipboard (warning: large)
  --date, -d          Override date (default: read from Excel)
  --report, -r        Show historical summary report
  --report-days N     Days for historical report (default: 30)
  --no-save           Don't save files
  --no-db             Don't save to SQLite database

OUTPUTS:
- epoch_analysis_YYYY-MM-DD.json  (Full data for deep analysis/Supabase)
- YYYY-MM-DD_daily_summary.txt    (Condensed for Claude chat ~2K tokens)
- epoch_history.db                (SQLite database for historical tracking)

The --copy flag copies the daily summary to clipboard for pasting into Claude.

================================================================================

JSON EXPORT STRUCTURE
================================================================================

The JSON file contains these main sections:

1. meta
   - date, generated_at, epoch_version
   - tickers_analyzed, ticker_list

2. market_context
   - composite_direction (BULLISH/BEARISH/NEUTRAL per ticker)
   - h4_dominant (H4 timeframe structure)
   - alignment_score (0-3, higher = more timeframe alignment)

3. tier_summary
   - total_zones, by_tier (T1/T2/T3 counts)
   - t1_percentage, t2_percentage, t3_percentage
   - tier_descriptions

4. zone_analysis
   - Per-ticker breakdown of primary/secondary zones
   - Zone boundaries (high/low), tier, confluence factors
   - Structure alignment, trade statistics per zone

5. trades (ARRAY)
   Each trade object contains:
   - trade_id: ticker_MMDDYY_model_HHMM (e.g., LLY_121225_EPCH2_1450)
   - date, ticker, model (EPCH1-4), zone_type (PRIMARY/SECONDARY)
   - direction (LONG/SHORT)
   - zone_high, zone_low
   - entry_price, entry_time, stop_price
   - target_3r, target_calc, target_used
   - exit_price, exit_time, exit_reason (STOP/TARGET_3R/TARGET_CALC/CHOCH/EOD)
   - pnl_dollars, pnl_r, risk, is_winner

6. no_trades
   - Zones that were tradeable but generated no signals

7. statistics
   - Overall: total_trades, wins, losses, win_rate, gross_profit/loss, net_pnl
   - R-Based: total_r, avg_win_r, avg_loss_r, expectancy
   - By Model: EPCH1-4 breakdown (trades, win_rate, net_r, expectancy)
   - By Exit Type: STOP, TARGET_3R, TARGET_CALC, CHOCH, EOD breakdown
   - By Direction: LONG vs SHORT performance

8. entry_analysis (ENRICHMENT DATA)
   - entries: Dict of EntryEvent data by trade_id
   - health_summary:
     * avg_health_score, min/max_health_score
     * by_label (STRONG/MODERATE/WEAK counts)
     * vwap_aligned_pct, trend_aligned_pct, structure_aligned_pct

9. exit_events (ENRICHMENT DATA)
   - total_events, trades_with_events counts
   - events_by_trade: Timeline of state changes per trade

10. optimal_trade_analysis (ENRICHMENT DATA)
    - trades: Dict of OptimalTrade data by trade_id
    - efficiency_summary:
      * avg_capture_efficiency (% of MFE captured)
      * avg_mfe_r, avg_mae_r, avg_optimal_r
      * total_potential_r

================================================================================

ENTRY EVENT DATA FIELDS
================================================================================

For each trade_id in entry_analysis.entries:

PRICE POSITION:
- entry_vwap: VWAP price at entry
- entry_vs_vwap: ABOVE/BELOW/AT
- entry_sma9, entry_vs_sma9: SMA9 position
- entry_sma21, entry_vs_sma21: SMA21 position
- sma9_vs_sma21: SMA9 ABOVE/BELOW SMA21

VOLUME ANALYSIS:
- entry_volume: Bar volume at entry
- avg_volume_5: 5-bar average volume
- volume_delta_pct: Volume vs average (%)
- volume_trend: EXPANDING/CONTRACTING/STABLE
- relative_volume: Volume ratio to average
- prior_bar_qual: Prior bar quality assessment
- vol_delta_class: LOW/NORMAL/HIGH/EXTREME
- vol_delta_value: Raw volume delta

MULTI-TIMEFRAME STRUCTURE:
- m5_structure: M5 market structure (BULLISH/BEARISH/NEUTRAL)
- m15_structure: M15 market structure
- h1_structure: H1 market structure  
- h4_structure: H4 market structure
- structure_align: Count of aligned timeframes (0-4)
- dominant_struct: Dominant structure direction
- m5_last_break: Last M5 structure break type
- m15_last_break: Last M15 structure break type

HEALTH SCORE:
- health_score: Entry quality score (0-7)
- health_max: Maximum possible score (7)
- health_pct: Score percentage
- health_label: STRONG (5-7), MODERATE (3-4), WEAK (0-2)

ALIGNMENT FLAGS:
- vwap_aligned: True if trade direction aligns with VWAP position
- trend_aligned: True if SMA trend supports trade direction
- structure_aligned: True if multi-TF structure supports direction

================================================================================

EXIT EVENT DATA FIELDS
================================================================================

For each trade_id in exit_events.events_by_trade (list of events):

EVENT TIMING:
- event_seq: Event sequence number (1, 2, 3...)
- event_time: HH:MM when event occurred
- bars_from_entry: Bars elapsed since entry
- bars_from_mfe: Bars elapsed since max favorable excursion

EVENT DETAILS:
- event_type: Type of event (e.g., HEALTH_DROP, STRUCTURE_FLIP, CHOCH)
- from_state: State before event
- to_state: State after event

POSITION AT EVENT:
- price_at_event: Price when event occurred
- r_at_event: R-multiple at event time
- health_score: Health score at event
- health_delta: Change in health score

INDICATOR VALUES:
- vwap, sma9, sma21: Indicator values at event
- volume: Volume at event
- swing_high, swing_low: Swing levels at event

================================================================================

OPTIMAL TRADE DATA FIELDS
================================================================================

For each trade_id in optimal_trade_analysis.trades:

OPTIMAL EXIT:
- optimal_exit_price: Best exit price identified
- optimal_exit_time: When optimal exit occurred
- optimal_exit_reason: Why this was optimal
- optimal_pnl_r: R-multiple at optimal exit

MFE (Max Favorable Excursion):
- mfe_price: Best price reached
- mfe_time: When MFE occurred
- mfe_r: R-multiple at MFE

MAE (Max Adverse Excursion):
- mae_price: Worst price reached
- mae_time: When MAE occurred
- mae_r: R-multiple at MAE (negative for losses)

EFFICIENCY:
- capture_efficiency: % of MFE captured (actual / optimal)
- notes: Additional context

================================================================================

DAILY SUMMARY STRUCTURE (for Claude chat)
================================================================================

The condensed summary (~2K tokens) contains these pre-computed sections:

1. PERFORMANCE OVERVIEW
   - Trades, wins, losses, win rate
   - Net R, expectancy, profit factor
   - Avg win R, avg loss R

2. BY MODEL
   - EPCH1-4 breakdown with [+]/[-] indicators
   - Trades, win rate, net R, expectancy per model

3. BY DIRECTION
   - LONG vs SHORT performance

4. BY EXIT TYPE
   - STOP, TARGET_3R, TARGET_CALC, CHOCH, EOD counts and net R

5. CONFLUENCE IMPACT (pre-computed analysis)
   - VWAP Aligned vs Not Aligned
   - Trend Aligned vs Not Aligned
   - Structure Aligned vs Not Aligned
   - Health by label (STRONG/MODERATE/WEAK)
   - Volume by class (LOW/NORMAL/HIGH/EXTREME)
   - Full Confluence (all 3 factors aligned)

6. CAPTURE EFFICIENCY
   - Avg capture efficiency %
   - Actual R vs Potential R
   - R left on table

7. TIMING ANALYSIS
   - Performance by hour with [+]/[-]/[~] indicators

8. NOTABLE TRADES
   - Top 3 best trades (trade_id, R, exit reason)
   - Top 3 worst trades

9. FLAGS & QUESTIONS
   - Auto-detected patterns:
     [!] Warnings (negative day, low win rate, high stop %)
     [?] Questions (direction bias, CHOCH effectiveness, weak entries)
   - Review questions for analysis

================================================================================

ENTRY MODEL DEFINITIONS
================================================================================

| Model  | Zone      | Entry Type   | Description                             |
|--------|-----------|--------------|----------------------------------------|
| EPCH1  | PRIMARY   | Continuation | Price traverses through primary zone    |
| EPCH2  | PRIMARY   | Rejection    | Price rejects from primary zone         |
| EPCH3  | SECONDARY | Continuation | Price traverses through secondary zone  |
| EPCH4  | SECONDARY | Rejection    | Price rejects from secondary zone       |

EXIT TYPES:
- STOP: Hit zone-based stop ($0.05 buffer)
- TARGET_3R: Hit 3R target
- TARGET_CALC: Hit calculated target from Module 07
- CHOCH: Change of Character (structure reversal)
- EOD: End of day forced exit (15:50 ET)

TIER DEFINITIONS:
- T1: Highest quality zones (strong confluence)
- T2: Moderate quality zones
- T3: Lower quality zones (minimal confluence)

================================================================================

TECHNICAL NOTES
================================================================================

- Entry enrichment data (entry_events, exit_events, optimal_trade) may be 
  empty if those worksheets don't exist in the Excel file yet
- Module gracefully handles missing worksheets with warnings
- All times are in ET (Eastern Time)
- R-multiples are calculated from zone-based stops ($0.05 buffer)
- Trade IDs format: ticker_MMDDYY_model_HHMM
- Excel serial times (fractions of day) converted to HH:MM format

================================================================================

VERSION HISTORY
================================================================================

v1.2 (2025-12-13):
- Added summary_exporter.py for condensed Claude-friendly output
- Daily summary includes pre-computed confluence analysis
- --copy now copies summary (not full JSON) to clipboard
- Added --copy-json option for full export
- ASCII-safe characters for Windows compatibility

v1.1 (2025-12-13):
- Added entry_events, exit_events, optimal_trade readers
- Fixed time formatting (Excel serial â†’ HH:MM)
- Added health summaries and capture efficiency analysis

v1.0 (2025-12-12):
- Initial release with basic trade statistics
- Zone analysis and tier summaries
- M5 price data integration

================================================================================
END OF DOCUMENTATION
================================================================================