{
  "_comment": "Epoch Trading System - Module 07: Setup Analysis Cell Map",
  "_version": "1.1",
  "_organization": "XIII Trading LLC",
  "_module": "07_setup_analysis",
  "_description": "Cell mappings for bull/bear setup identification, target selection, and R:R calculation",
  "_directory": "02_zone_system/07_setup_analysis/",
  "_version_notes": "V1.1: Added tier column, shifted setup columns N-S to O-T, expanded Analysis columns, all ranks (L1-L5) now included",

  "worksheets": {
    "zone_results": "zone_results",
    "bar_data": "bar_data",
    "market_overview": "market_overview",
    "analysis": "Analysis"
  },

  "zone_results_input": {
    "_description": "Filtered L1-L5 zones from Module 06 (V1.1: includes tier)",
    "header_row": 1,
    "data_start_row": 2,
    "columns": {
      "ticker_id": "A",
      "ticker": "B",
      "date": "C",
      "price": "D",
      "direction": "E",
      "zone_id": "F",
      "hvn_poc": "G",
      "zone_high": "H",
      "zone_low": "I",
      "overlaps": "J",
      "score": "K",
      "rank": "L",
      "confluences": "M",
      "tier": "N"
    }
  },

  "zone_results_output": {
    "_description": "Setup columns added by Module 07 (V1.1: shifted from N-S to O-T)",
    "columns": {
      "epch_bull": "O",
      "epch_bear": "P",
      "epch_bull_price": "Q",
      "epch_bear_price": "R",
      "epch_bull_target": "S",
      "epch_bear_target": "T"
    },
    "column_descriptions": {
      "epch_bull": "'X' marks bull POC zone for ticker",
      "epch_bear": "'X' marks bear POC zone for ticker",
      "epch_bull_price": "Bull zone hvn_poc value",
      "epch_bear_price": "Bear zone hvn_poc value",
      "epch_bull_target": "Bull target price",
      "epch_bear_target": "Bear target price"
    },
    "_note": "Tier column (N) is written by Module 06, not modified by Module 07"
  },

  "tier_classification": {
    "_description": "V1.1: Quality tier mapping from L-ranks",
    "tier_mapping": {
      "L1": "T1",
      "L2": "T1",
      "L3": "T2",
      "L4": "T3",
      "L5": "T3"
    },
    "tier_descriptions": {
      "T1": "Lower Quality",
      "T2": "Medium Quality",
      "T3": "High Quality"
    },
    "_note": "Selection is proximity-based, tier indicates quality for trader discretion"
  },

  "bar_data_input": {
    "_description": "HVN POCs for target selection",
    "ticker_structure": {
      "_rows": "4-13",
      "columns": {
        "ticker_id": "B",
        "price": "E"
      }
    },
    "time_hvn": {
      "_rows": "59-68",
      "columns": {
        "ticker": "C",
        "hvn_poc1": "F",
        "hvn_poc2": "G",
        "hvn_poc3": "H",
        "hvn_poc4": "I",
        "hvn_poc5": "J",
        "hvn_poc6": "K",
        "hvn_poc7": "L",
        "hvn_poc8": "M",
        "hvn_poc9": "N",
        "hvn_poc10": "O"
      }
    },
    "rows": {
      "t1": {"ticker_row": 4, "hvn_row": 59},
      "t2": {"ticker_row": 5, "hvn_row": 60},
      "t3": {"ticker_row": 6, "hvn_row": 61},
      "t4": {"ticker_row": 7, "hvn_row": 62},
      "t5": {"ticker_row": 8, "hvn_row": 63},
      "t6": {"ticker_row": 9, "hvn_row": 64},
      "t7": {"ticker_row": 10, "hvn_row": 65},
      "t8": {"ticker_row": 11, "hvn_row": 66},
      "t9": {"ticker_row": 12, "hvn_row": 67},
      "t10": {"ticker_row": 13, "hvn_row": 68}
    }
  },

  "market_overview_input": {
    "_description": "Direction for primary/secondary assignment",
    "ticker_structure": {
      "_rows": "36-45",
      "columns": {
        "ticker_id": "B",
        "composite": "R"
      }
    },
    "rows": {
      "t1": 36,
      "t2": 37,
      "t3": 38,
      "t4": 39,
      "t5": 40,
      "t6": 41,
      "t7": 42,
      "t8": 43,
      "t9": 44,
      "t10": 45
    },
    "direction_values": ["Bull", "Bull+", "Bear", "Bear+"]
  },

  "analysis_output": {
    "_description": "Primary and Secondary setups written to Analysis worksheet (V1.1: expanded for tier)",
    "primary_section": {
      "header_row": 30,
      "data_start_row": 31,
      "data_end_row": 40,
      "columns": {
        "ticker": "B",
        "direction": "C",
        "ticker_id": "D",
        "zone_id": "E",
        "hvn_poc": "F",
        "zone_high": "G",
        "zone_low": "H",
        "tier": "I",
        "target_id": "J",
        "target": "K",
        "r_r": "L"
      },
      "data_range": "B31:L40",
      "header_range": "B30:L30"
    },
    "secondary_section": {
      "header_row": 30,
      "data_start_row": 31,
      "data_end_row": 40,
      "columns": {
        "ticker": "N",
        "direction": "O",
        "ticker_id": "P",
        "zone_id": "Q",
        "hvn_poc": "R",
        "zone_high": "S",
        "zone_low": "T",
        "tier": "U",
        "target_id": "V",
        "target": "W",
        "r_r": "X"
      },
      "data_range": "N31:X40",
      "header_range": "N30:X30"
    },
    "headers": ["Ticker", "Direction", "Ticker ID", "Zone ID", "HVN POC", "Zone High", "Zone Low", "Tier", "Target ID", "Target", "R:R"]
  },

  "algorithm_parameters": {
    "min_rr_threshold": 3.0,
    "default_rr_calc": 4.0,
    "valid_ranks": ["L1", "L2", "L3", "L4", "L5"],
    "_v1.1_note": "All ranks now included - selection is proximity-based, not filtered by rank"
  },

  "bull_bear_identification": {
    "_description": "How bull and bear POC anchors are identified (V1.1: proximity-based, all ranks)",
    "bull_poc": "LOWEST-priced zone ABOVE current price (closest above) - ALL L1-L5 zones",
    "bear_poc": "HIGHEST-priced zone BELOW current price (closest below) - ALL L1-L5 zones",
    "pivot_logic": "If only one exists, use same zone for both directions",
    "_v1.1_note": "No rank filter - tier indicates quality, not selection priority"
  },

  "target_selection": {
    "_description": "3R/4R cascade logic for target identification",
    "bull_target": {
      "zone_risk": "zone_high - zone_low",
      "target_3r": "zone_high + (zone_risk × 3.0)",
      "target_4r": "zone_high + (zone_risk × 4.0)",
      "selection": "Find POC > hvn_poc AND >= target_3r (prefer lowest index)",
      "fallback": "target_4r with target_id='4R_calc'"
    },
    "bear_target": {
      "zone_risk": "zone_high - zone_low",
      "target_3r": "zone_low - (zone_risk × 3.0)",
      "target_4r": "zone_low - (zone_risk × 4.0)",
      "selection": "Find POC < hvn_poc AND <= target_3r (prefer lowest index)",
      "fallback": "target_4r with target_id='4R_calc'"
    }
  },

  "primary_secondary_assignment": {
    "Bull": {"primary": "bull zone", "secondary": "bear zone (direction=Bear)"},
    "Bull+": {"primary": "bull zone", "secondary": "bear zone (direction=Bear)"},
    "Bear": {"primary": "bear zone", "secondary": "bull zone (direction=Bull)"},
    "Bear+": {"primary": "bear zone", "secondary": "bull zone (direction=Bull)"}
  },

  "rr_calculation": {
    "bull_trade": {
      "reward": "target - hvn_poc",
      "risk": "hvn_poc - zone_low",
      "r_r": "reward / risk"
    },
    "bear_trade": {
      "reward": "hvn_poc - target",
      "risk": "zone_high - hvn_poc",
      "r_r": "reward / risk"
    }
  },

  "cell_reference_examples": {
    "t1_hvn_poc1": "F59",
    "t1_composite": "R36",
    "primary_first_ticker": "B31",
    "primary_first_tier": "I31",
    "primary_first_rr": "L31",
    "secondary_first_ticker": "N31",
    "secondary_first_tier": "U31",
    "secondary_first_rr": "X31",
    "zone_results_tier_first": "N2",
    "zone_results_epch_bull_first": "O2",
    "zone_results_epch_bear_target_first": "T2"
  }
}
