{
  "_comment": "Epoch Trading System - Backtest Entry Events Cell Map",
  "_version": "4.1.0",
  "_organization": "XIII Trading LLC",
  "_module": "09_backtest/processor/entry_events",
  "_description": "Cell mappings for entry events enrichment subsystem (DOW_AI aligned + Win column)",
  "_directory": "02_zone_system/09_backtest/processor/entry_events/",

  "input_worksheet": "backtest",
  "output_worksheet": "entry_events",

  "backtest_input": {
    "_description": "Trade data read from backtest worksheet (v2.3 format)",
    "_columns": "A-U",
    "columns": {
      "trade_id": "A",
      "date": "B",
      "ticker": "C",
      "model": "D",
      "zone_type": "E",
      "direction": "F",
      "zone_high": "G",
      "zone_low": "H",
      "entry_price": "I",
      "entry_time": "J",
      "stop_price": "K",
      "target_3r": "L",
      "target_calc": "M",
      "target_used": "N",
      "exit_price": "O",
      "exit_time": "P",
      "exit_reason": "Q",
      "pnl_dollars": "R",
      "pnl_r": "S",
      "risk": "T",
      "win": "U"
    }
  },

  "entry_events_output": {
    "_description": "Entry enrichment data (v4.1: DOW_AI aligned + Win column)",
    "_total_columns": 44,
    "_column_range": "A-AR",
    "header_row": 1,
    "data_start_row": 2,

    "join_key": {
      "_columns": "A",
      "_count": 1,
      "A": {
        "header": "Trade_ID",
        "type": "string",
        "description": "Join key to backtest worksheet (format: ticker_MMDDYY_model_HHMM)"
      }
    },

    "vwap_analysis": {
      "_columns": "B-I",
      "_count": 8,
      "B": {"header": "Entry_VWAP", "type": "float", "description": "VWAP at entry time"},
      "C": {"header": "Entry_vs_VWAP", "type": "string", "description": "ABOVE/BELOW/AT"},
      "D": {"header": "VWAP_Diff", "type": "float", "description": "Price - VWAP in dollars"},
      "E": {"header": "VWAP_Pct", "type": "float", "description": "Percentage difference from VWAP"},
      "F": {"header": "Entry_SMA9", "type": "float", "description": "SMA9 at entry time"},
      "G": {"header": "Entry_vs_SMA9", "type": "string", "description": "ABOVE/BELOW"},
      "H": {"header": "Entry_SMA21", "type": "float", "description": "SMA21 at entry time"},
      "I": {"header": "Entry_vs_SMA21", "type": "string", "description": "ABOVE/BELOW"}
    },

    "sma_analysis": {
      "_columns": "J-M",
      "_count": 4,
      "J": {"header": "SMA9_vs_SMA21", "type": "string", "description": "BULLISH/BEARISH"},
      "K": {"header": "SMA_Spread", "type": "float", "description": "SMA9 - SMA21"},
      "L": {"header": "SMA_Spread_Momentum", "type": "string", "description": "WIDENING/NARROWING/FLAT"},
      "M": {"header": "Cross_Price_Est", "type": "float", "description": "(SMA9 + SMA21) / 2"}
    },

    "volume_analysis": {
      "_columns": "N-V",
      "_count": 9,
      "N": {"header": "Entry_Volume", "type": "integer", "description": "Volume of entry bar"},
      "O": {"header": "Vol_ROC", "type": "float", "description": "Volume ROC % vs 20-bar avg"},
      "P": {"header": "Vol_ROC_Signal", "type": "string", "description": "Above Avg/Below Avg/Average"},
      "Q": {"header": "Vol_Baseline_Avg", "type": "float", "description": "20-bar volume baseline"},
      "R": {"header": "Vol_Delta_Signal", "type": "string", "description": "Bullish/Bearish/Neutral"},
      "S": {"header": "Vol_Delta_Value", "type": "float", "description": "Bar-position rolling delta"},
      "T": {"header": "CVD_Trend", "type": "string", "description": "Rising/Falling/Flat"},
      "U": {"header": "CVD_Slope", "type": "float", "description": "Normalized CVD slope"},
      "V": {"header": "Relative_Volume", "type": "float", "description": "Entry vol / 5-bar avg ratio"}
    },

    "multi_timeframe_structure": {
      "_columns": "W-AF",
      "_count": 10,
      "W": {"header": "M5_Structure", "type": "string", "description": "BULL/BEAR/NEUTRAL"},
      "X": {"header": "M15_Structure", "type": "string", "description": "BULL/BEAR/NEUTRAL"},
      "Y": {"header": "H1_Structure", "type": "string", "description": "BULL/BEAR/NEUTRAL"},
      "Z": {"header": "H4_Structure", "type": "string", "description": "BULL/BEAR/NEUTRAL"},
      "AA": {"header": "Structure_Alignment", "type": "integer", "description": "Alignment score (0-4)"},
      "AB": {"header": "Dominant_Structure", "type": "string", "description": "BULL/BEAR/NEUTRAL/MIXED"},
      "AC": {"header": "M5_Last_Break", "type": "string", "description": "Last M5 BOS/ChoCH type"},
      "AD": {"header": "M15_Last_Break", "type": "string", "description": "Last M15 BOS/ChoCH type"},
      "AE": {"header": "M5_Pct_to_Strong", "type": "float", "description": "% distance to strong level"},
      "AF": {"header": "M5_Pct_to_Weak", "type": "float", "description": "% distance to weak level"}
    },

    "entry_health_score": {
      "_columns": "AG-AJ",
      "_count": 4,
      "AG": {"header": "Health_Score", "type": "integer", "description": "Score 0-10 (DOW_AI 10-factor)"},
      "AH": {"header": "Health_Max", "type": "integer", "description": "Always 10"},
      "AI": {"header": "Health_Pct", "type": "float", "description": "Percentage (0-100)"},
      "AJ": {"header": "Health_Label", "type": "string", "description": "CRITICAL/WEAK/MODERATE/STRONG"}
    },

    "alignment_flags": {
      "_columns": "AK-AN",
      "_count": 4,
      "AK": {"header": "HTF_Aligned", "type": "integer", "description": "H4 + H1 aligned (1=Yes, 0=No)"},
      "AL": {"header": "MTF_Aligned", "type": "integer", "description": "M15 + M5 aligned (1=Yes, 0=No)"},
      "AM": {"header": "Vol_Aligned", "type": "integer", "description": "All 3 volume factors aligned (1=Yes, 0=No)"},
      "AN": {"header": "Ind_Aligned", "type": "integer", "description": "SMA + VWAP aligned (1=Yes, 0=No)"}
    },

    "processing_metadata": {
      "_columns": "AO-AQ",
      "_count": 3,
      "AO": {"header": "Enrichment_Time", "type": "datetime", "description": "When enrichment was performed"},
      "AP": {"header": "Status", "type": "string", "description": "SUCCESS/ERROR/PENDING"},
      "AQ": {"header": "Error", "type": "string", "description": "Error message if status=ERROR"}
    },

    "trade_outcome": {
      "_columns": "AR",
      "_count": 1,
      "_new_in": "v4.1.0",
      "AR": {"header": "Win", "type": "integer", "description": "Trade outcome (1=Win, 0=Loss from backtest)"}
    }
  },

  "health_score_methodology": {
    "_description": "10 binary factors evaluated for health score (0-10) - DOW_AI aligned",
    "factors": {
      "1_h4_structure": "LONG: H4=BULL | SHORT: H4=BEAR",
      "2_h1_structure": "LONG: H1=BULL | SHORT: H1=BEAR",
      "3_m15_structure": "LONG: M15=BULL | SHORT: M15=BEAR",
      "4_m5_structure": "LONG: M5=BULL | SHORT: M5=BEAR",
      "5_vol_roc": "Vol_ROC > +20% (Above Avg)",
      "6_vol_delta": "LONG: Vol_Delta > 0 | SHORT: Vol_Delta < 0",
      "7_cvd": "LONG: CVD_Slope > 0.1 | SHORT: CVD_Slope < -0.1",
      "8_sma_align": "LONG: SMA9 > SMA21 | SHORT: SMA9 < SMA21",
      "9_sma_momentum": "SMA_Spread_Momentum = WIDENING",
      "10_vwap": "LONG: Entry > VWAP | SHORT: Entry < VWAP"
    },
    "labels": {
      "8-10": "STRONG",
      "6-7": "MODERATE",
      "4-5": "WEAK",
      "0-3": "CRITICAL"
    }
  },

  "structure_lookback_periods": {
    "M5": {"days": 5, "min_bars": 50},
    "M15": {"days": 15, "min_bars": 100},
    "H1": {"days": 50, "min_bars": 150},
    "H4": {"days": 100, "min_bars": 100}
  },

  "volume_calculations": {
    "volume_roc": {
      "formula": "((current_vol - baseline_avg) / baseline_avg) * 100",
      "baseline_bars": 20,
      "thresholds": {
        "above_avg": "> 20%",
        "below_avg": "< -20%",
        "average": "-20% to +20%"
      }
    },
    "volume_delta": {
      "formula": "sum(bar_delta) for 5 bars",
      "bar_delta": "volume * ((2 * (close - low) / (high - low)) - 1)"
    },
    "cvd_direction": {
      "formula": "linear_regression_slope(cumsum(bar_deltas)[-15:])",
      "thresholds": {
        "rising": "> 0.1",
        "falling": "< -0.1",
        "flat": "-0.1 to +0.1"
      }
    }
  },

  "data_relationship": {
    "_description": "entry_events has 1:1 relationship with backtest via trade_id",
    "join_key": "trade_id",
    "relationship": "1:1"
  },

  "xlookup_formulas": {
    "_description": "Excel formulas to join with backtest data",
    "get_ticker": "=XLOOKUP(A2, backtest!A:A, backtest!C:C)",
    "get_date": "=XLOOKUP(A2, backtest!A:A, backtest!B:B)",
    "get_direction": "=XLOOKUP(A2, backtest!A:A, backtest!F:F)",
    "get_entry_price": "=XLOOKUP(A2, backtest!A:A, backtest!I:I)",
    "get_pnl_r": "=XLOOKUP(A2, backtest!A:A, backtest!S:S)",
    "get_win": "=XLOOKUP(A2, backtest!A:A, backtest!U:U)"
  },

  "version_history": {
    "v4.1.0": "Added Win column (AR) from backtest - 44 columns",
    "v4.0.0": "DOW_AI aligned with 10-factor health scoring - 43 columns",
    "v3.0.0": "Lean architecture with 7-factor health scoring - 34 columns"
  }
}
