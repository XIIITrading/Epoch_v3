================================================================================
EPOCH DOW AI - CONTINUOUS IMPROVEMENT LOOP PROCESS
XIII Trading LLC | January 2026
================================================================================

OBJECTIVE
---------
Build a systematic feedback loop that uses Claude API batch analysis to identify
indicator logic errors, then uses Claude Desktop to analyze findings and generate
prompt improvements - creating a self-refining AI trading assistant.

================================================================================
PHASE 1: BASELINE ESTABLISHMENT
================================================================================

Step 1.1: Run Full Trade Stack Through Claude API
- Command: python run_batch.py --include-processed
- Output: ai_predictions table populated with predictions, reasoning, indicators
- Metric: Overall accuracy % (currently ~50% baseline)

Step 1.2: Segment by Direction (LONG vs SHORT)
- Run diagnostic exporter to generate direction-specific analysis
- Compare LONG accuracy vs SHORT accuracy
- Identify which direction has larger accuracy gap

Step 1.3: Document Baseline Metrics
- Total trades by direction
- Prediction accuracy by direction
- Win rate by direction
- Confusion matrix (true/false positives/negatives)

================================================================================
PHASE 2: INDICATOR DIAGNOSIS (Per Direction)
================================================================================

Step 2.1: Export Indicator Diagnostics
- Command: python -m reports.diagnostic_exporter
- Output: 6 diagnostic .txt files in outputs/diagnostics/

Step 2.2: Analyze Each Indicator
For each indicator (vol_delta, vol_roc, candle_range, sma, h1_struct):
  a) Check if status logic is direction-aware
  b) Compare win rates across status values (FAVORABLE/NEUTRAL/WEAK)
  c) Identify inversions (e.g., "FAVORABLE" status with lower win rate)
  d) Document expected vs actual behavior

Step 2.3: Prioritize Fixes
- Rank indicators by impact (frequency x accuracy delta)
- Fix highest-impact errors first
- Document each fix with before/after logic

================================================================================
PHASE 3: PROMPT/LOGIC FIX
================================================================================

Step 3.1: Update Status Assignment Logic
- File: batch_analyzer/prompts/batch_prompt.py
- File: entry_qualifier/ai/compact_prompt.py
- File: batch_analyzer/scripts/batch_analyze.py
- Ensure all three files have consistent logic

Step 3.2: Add Direction-Specific Context to Prompt
- Include explicit guidance: "For SHORT trades, negative vol_delta is favorable"
- Add model-specific decision rules as data accumulates

Step 3.3: Version Control
- Commit changes with clear description of what was fixed
- Tag prompt version in ai_predictions table for A/B comparison

================================================================================
PHASE 4: RE-TEST AFFECTED SUBSET
================================================================================

Step 4.1: Re-run Affected Trades
- Command: python run_batch.py --direction SHORT --include-processed
- This overwrites existing predictions with new logic

Step 4.2: Measure Improvement
- Run diagnostic exporter again
- Compare before/after accuracy for affected direction
- Document delta: "SHORT accuracy improved from X% to Y%"

Step 4.3: Validate No Regression
- Check that LONG accuracy didn't degrade
- Check overall accuracy improvement

================================================================================
PHASE 5: ITERATE TO NEXT INDICATOR
================================================================================

Step 5.1: Update Refinement Backlog
- Mark completed indicator as DONE
- Move to next priority indicator
- Document learnings for future reference

Step 5.2: Repeat Phases 2-4
- Continue until all indicators are validated
- Each cycle should show incremental accuracy improvement

================================================================================
REFINEMENT BACKLOG (Priority Order)
================================================================================

Direction-Level Fixes (Current Focus):
[x] Vol Delta - SHORT logic inverted (FIXED 2026-01-24)
[ ] Vol Delta - Validate fix improves SHORT accuracy
[ ] SMA Config - Add direction alignment signal
[ ] H1 Structure - Add direction alignment signal
[ ] Vol ROC - Check if direction context needed
[ ] Candle Range - Validate thresholds by direction

Model-Level Fixes (Future):
[ ] EPCH1/3 (Continuation) - Momentum pattern expectations
[ ] EPCH2/4 (Rejection) - Absorption pattern expectations
[ ] Model-specific win rate context in prompt

Ticker-Level Fixes (Future):
[ ] High-volatility tickers (TSLA, NVDA) - Adjust thresholds
[ ] Low-volatility tickers - Adjust thresholds

================================================================================
FILE LOCATIONS
================================================================================

Batch Processing:
  C:\XIIITradingSystems\Epoch\04_dow_ai\batch_analyzer\scripts\run_batch.py

Prompt Logic:
  C:\XIIITradingSystems\Epoch\04_dow_ai\batch_analyzer\prompts\batch_prompt.py
  C:\XIIITradingSystems\Epoch\04_dow_ai\entry_qualifier\ai\compact_prompt.py

Diagnostic Export:
  C:\XIIITradingSystems\Epoch\04_dow_ai\batch_analyzer\reports\diagnostic_exporter.py

Diagnostic Output:
  C:\XIIITradingSystems\Epoch\04_dow_ai\batch_analyzer\outputs\diagnostics\

AI Context (Historical Performance):
  C:\XIIITradingSystems\Epoch\04_dow_ai\ai_context\indicator_edges.json
  C:\XIIITradingSystems\Epoch\04_dow_ai\ai_context\zone_performance.json

================================================================================
COMMANDS REFERENCE
================================================================================

# Run batch on specific direction
python run_batch.py --direction SHORT --include-processed --limit 100

# Run full direction re-analysis
python run_batch.py --direction SHORT --include-processed

# Export diagnostics for Claude Desktop review
python -m reports.diagnostic_exporter

# Dry-run to see trade count
python run_batch.py --direction SHORT --include-processed --dry-run

================================================================================
SUCCESS CRITERIA
================================================================================

Phase 1 Complete: Baseline accuracy documented by direction
Phase 2 Complete: All indicator logic errors identified
Phase 3 Complete: Fixes implemented and tested on subset
Phase 4 Complete: Full re-run shows measurable improvement
Phase 5 Complete: Process documented for next iteration

Target: Improve prediction accuracy from 50% baseline to 65%+ through
        systematic indicator logic refinement.

================================================================================
