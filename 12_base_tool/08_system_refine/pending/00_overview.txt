================================================================================
OPTIONS ANALYSIS TAB REFACTOR - IMPLEMENTATION OVERVIEW
================================================================================
Project: Epoch Trading System
Module: 12_system_analysis
Goal: Make Options Analysis tab match Metrics Overview layout and calculations
Date: 2025-01-10
================================================================================

OBJECTIVE
---------
Refactor the Options Analysis tab to have the EXACT same layout and calculation
structure as the Metrics Overview tab. This includes adding stop type analysis,
stop-based win rate calculations, and simulated outcomes for options.

================================================================================
CURRENT STATE
================================================================================

METRICS OVERVIEW TAB (Reference - What We Want to Match):
---------------------------------------------------------
1. CALC-009: Stop Type Analysis (Foundation)
   - 6 stop types compared (zone_buffer, prior_m1, prior_m5, m5_atr, m15_atr, fractal)
   - Summary cards, comparison table, charts
   - Breakdown by model type, direction

2. Stop Type Selector
   - User selects stop type for downstream analysis
   - Default: Zone + 5% Buffer

3. CALC-001: Win Rate by Model (Using Selected Stop)
   - Win = 1R profit reached before selected stop hit
   - Summary table and charts

4. CALC-002: MFE/MAE Distribution Analysis
   - Raw percentage-based analysis
   - Histograms, scatter plots, model breakdown

5. CALC-003: MFE/MAE Sequence Analysis
   - P(MFE First) Monte Carlo baseline
   - Time distribution analysis

6. CALC-004: Simulated Outcome Analysis
   - Stop/target parameter grid
   - Optimal parameter identification

7. Monte AI Integration
   - Comprehensive prompt with all analysis results

OPTIONS ANALYSIS TAB (Current State):
-------------------------------------
1. CALC-O01: Win Rate by Model
   - Simple: Win = exit_pct > 0 at 15:30 ET
   - NO stop-based analysis

2. CALC-O02: MFE/MAE Distribution
   - Percentage-based (mfe_pct, mae_pct)
   - Similar to Metrics Overview

3. CALC-O03: MFE/MAE Sequence Analysis
   - P(MFE First) by model/contract
   - Similar to Metrics Overview

4. CALC-O04: Options vs Underlying
   - Leverage comparison (unique to options)

5. Monte AI (Simplified)
   - Missing stop analysis data

================================================================================
IMPLEMENTATION FILES
================================================================================

File                          | Description
------------------------------|---------------------------------------------
01_op_stop_analysis.txt       | CALC-O09: Options Stop Type Analysis
02_op_stop_selector.txt       | Stop Type Selector for Options
03_op_win_rate_update.txt     | Modify CALC-O01 for stop-based wins
04_op_simulated_outcomes.txt  | CALC-O05: Options Simulated Outcomes
05_monte_ai_update.txt        | Update Monte AI integration
06_app_integration.txt        | Main app.py changes and tab layout

================================================================================
KEY DIFFERENCES: OPTIONS VS UNDERLYING
================================================================================

1. STOP CALCULATION APPROACH
   - Underlying: Price-based stops (zone_low, ATR, prior bar low)
   - Options: Percentage-based stops (10%, 15%, 20%, 25%, 30% of entry)

   Rationale: Options don't have "zones" - they are derivatives. Stop placement
   should be based on acceptable % loss from option entry price.

2. WIN DEFINITION
   - Underlying: MFE reaches 1R before stop hit
   - Options: MFE% reaches target% before stop% hit

   Example: Stop = 25% loss, Target = 50% gain
   Win = Option reaches +50% before hitting -25%

3. DATA TABLES
   - Underlying: mfe_mae_potential, stop_analysis
   - Options: op_mfe_mae_potential, op_stop_analysis (NEW)

4. UNIQUE OPTIONS CONSIDERATIONS
   - Keep CALC-O04 (Options vs Underlying) as it's unique to options
   - Contract type (CALL/PUT) is an additional grouping dimension

================================================================================
NEW FILES TO CREATE
================================================================================

Location: C:\XIIITradingSystems\Epoch\02_zone_system\12_system_analysis\

CALCULATIONS MODULE:
calculations/options/
    op_stop_analysis/
        __init__.py
        stop_calculator.py      # Calculate stop prices for options
        outcome_simulator.py    # Simulate outcomes at each stop
        results_aggregator.py   # Aggregate results by stop type
        ui_components.py        # Streamlit display components
    op_stop_selector.py         # Stop type selection and state
    op_simulated_outcomes.py    # Grid simulation for options

DATA MODULE (if needed):
data/
    supabase_client.py          # Add fetch_op_stop_analysis() method

BACKTEST PROCESSOR (for pre-calculation):
C:\XIIITradingSystems\Epoch\02_zone_system\09_backtest\processor\secondary_analysis\
    op_stop_analysis/
        runner.py
        calculator.py
        schema/op_stop_analysis.sql

================================================================================
IMPLEMENTATION ORDER
================================================================================

PHASE 1: FOUNDATION (Files 01-02)
- Create options stop type definitions
- Create stop calculator for options
- Create UI components for stop analysis
- Add stop type selector

PHASE 2: CALCULATIONS (Files 03-04)
- Modify CALC-O01 to use stop-based outcomes
- Create CALC-O05 simulated outcomes

PHASE 3: INTEGRATION (Files 05-06)
- Update Monte AI prompt generator
- Integrate all components into app.py
- Test and validate

================================================================================
QUESTIONS FOR REVIEW
================================================================================

1. STOP TYPES FOR OPTIONS - Proposed list:
   - 10% Loss Stop
   - 15% Loss Stop
   - 20% Loss Stop
   - 25% Loss Stop
   - 30% Loss Stop
   - 50% Loss Stop (wide stop)

   Q: Are these the right stop levels to analyze? Should we add more/fewer?

2. TARGET LEVELS - Proposed list:
   - 25% Gain Target
   - 50% Gain Target
   - 75% Gain Target
   - 100% Gain Target (double)
   - 150% Gain Target

   Q: Are these appropriate target levels for options?

3. PRE-CALCULATION VS RUNTIME
   - Underlying stop analysis is pre-calculated and stored in Supabase
   - Q: Should options stop analysis also be pre-calculated, or is runtime
        calculation acceptable given the simpler percentage-based approach?

4. CONTRACT TYPE HANDLING
   - Q: Should CALL and PUT have different stop recommendations, or treat them
        the same since they're both directional bets?

================================================================================
NEXT STEPS
================================================================================

1. Review this overview document
2. Review each implementation file (01-06)
3. Provide feedback on questions above
4. Approve or modify the implementation plan
5. Begin development

================================================================================
