================================================================================
EPOCH TRADING SYSTEM - MODULE 02: TICKER STRUCTURE
XIII Trading LLC | Documentation v1.0
================================================================================

PURPOSE
-------
Processes user-defined ticker list (up to 10 tickers) for market structure
analysis. Reads tickers from Excel C36:C45, calculates Bull/Bear direction
across D1/H4/H1/M15, writes results back to same rows. Identical calculation
logic to Module 01 but with dynamic ticker input instead of fixed SPY/QQQ/DIA.

DIRECTORY
---------
02_zone_system/02_ticker_structure/

================================================================================
FILE INVENTORY
================================================================================

FILE: epoch_ticker_structure_config.py
--------------------------------------
Role: Central configuration - mirrors Module 01 config with dynamic ticker rows.

Key Differences from Module 01:
  - TICKER_INPUT_ROWS: list(range(36, 46)) - reads from C36:C45
  - TICKER_ROWS dict: Maps position 1-10 to rows 36-45
  - validate_ticker(ticker): Validates 1-5 letter alphabetic symbols

Contains:
  - POLYGON_API_KEY, POLYGON_BASE_URL (same as Module 01)
  - TIMEFRAMES dict: D1/H4/H1/M15/M1 (identical to Module 01)
  - FRACTAL_LENGTH = 5
  - EXCEL_FILEPATH: C:\XIIITradingSystems\Epoch\epoch_v1.xlsm
  - WORKSHEET_NAME: 'market_overview'
  - COLUMNS dict: B-R column mappings (same structure as Module 01)
  - DATA_LOOKBACK_DAYS, API rate limiting (identical to Module 01)

Key Functions:
  - get_cell_reference(row, column) -> "B36"
  - validate_ticker(ticker) -> True/False (1-5 alpha chars)
  - format_ticker_id(ticker) -> "AMD_112525"
  - format_price(price) -> "125.50" or "NULL"
  - calculate_weighted_direction(results) -> "Bull+", "Bull", "Bear+", "Bear"

Request this file for: Ticker validation rules, row mappings, adding more
ticker slots, modifying input range.

--------------------------------------------------------------------------------

FILE: polygon_data_fetcher.py
-----------------------------
Role: Polygon.io API integration (identical logic to Module 01).

Class: PolygonDataFetcher
  - Imports epoch_ticker_structure_config (not market_structure_config)
  - All methods identical to Module 01 version

Request this file for: API issues, data fetch problems. Note: Could potentially
be shared with Module 01 via refactor.

--------------------------------------------------------------------------------

FILE: ticker_structure_calculator.py
------------------------------------
Role: Core structure algorithm (identical logic to Module 01).

Class: MarketStructureCalculator
  - Imports epoch_ticker_structure_config
  - All calculation logic identical to Module 01:
    - _detect_fractals()
    - _calculate_structure()
    - calculate() -> direction, strong_level, weak_level

Request this file for: Structure calculation issues. Note: Could potentially
be shared with Module 01 via refactor to common module.

--------------------------------------------------------------------------------

FILE: ticker_structure_runner.py
--------------------------------
Role: Main execution script - reads dynamic ticker list, processes, writes.

Key Difference from Module 01:
  - read_ticker_list(ws) -> List[(row, ticker)]: Reads C36:C45, skips empties

Functions:
  connect_to_workbook() -> xlwings workbook
  
  read_ticker_list(ws) -> List[Tuple[int, str]]:
    - Iterates TICKER_INPUT_ROWS (36-45)
    - Skips empty/None cells
    - Validates each ticker via config.validate_ticker()
    - Returns list of (row_num, ticker) tuples
    - Example: [(36, 'AMD'), (37, 'NVDA'), (39, 'TSLA')]
  
  fetch_ticker_data(ticker, fetcher) -> dict[timeframe: DataFrame]
  fetch_scan_price_data(ticker, fetcher) -> DataFrame
  calculate_all_structures(ticker, data, calculator) -> dict[timeframe: result]
  get_scan_price(df_m1) -> float
  
  write_ticker_results(ws, row_num, ticker, scan_price, results, composite):
    - Takes row_num as parameter (vs Module 01 which looks up from ticker)
    - Writes to the same row where ticker was read
  
  run():
    - Reads ticker list first
    - Exits gracefully if no tickers found
    - Processes only populated rows

Execution Flow:
  1. Connect to Excel workbook
  2. Read tickers from C36:C45 (skip empties)
  3. If no tickers, exit with message
  4. Initialize PolygonDataFetcher and MarketStructureCalculator
  5. For each (row, ticker) pair:
     a. Fetch D1/H4/H1/M15 data
     b. Calculate structure for each timeframe
     c. Calculate weighted composite
     d. Fetch M1 for scan price (fallback to D1)
     e. Write results to ticker's row
  6. Save workbook

Request this file for: Workflow changes, ticker reading logic, output issues.

================================================================================
EXCEL I/O STRUCTURE
================================================================================

Worksheet: market_overview

INPUT:
  C36:C45 - User enters ticker symbols (1-10 tickers, gaps allowed)

OUTPUT (for each populated row 36-45):
  B: Ticker ID (AMD_112525 format)
  C: Ticker symbol (normalized uppercase)
  D: Run datetime
  E: Scan price (M1 close)
  F: D1 Direction (Bull/Bear/Neutral/ERROR)
  G: D1 Strong Level
  H: D1 Weak Level
  I-K: H4 (same pattern)
  L-N: H1 (same pattern)
  O-Q: M15 (same pattern)
  R: Composite (Bull+/Bull/Bear+/Bear)

================================================================================
RELATIONSHIP TO MODULE 01
================================================================================

Module 01 (Market Structure):
  - Fixed tickers: SPY, QQQ, DIA
  - Fixed rows: 29, 30, 31
  - Hardcoded ticker list in config

Module 02 (Ticker Structure):
  - Dynamic tickers: User-defined, up to 10
  - Dynamic rows: 36-45 (reads from C column)
  - Includes ticker validation

Shared Logic (identical algorithms):
  - Fractal detection
  - BOS/ChoCH identification
  - Strong/Weak level calculation
  - Weighted composite direction
  - Polygon API fetching

REFACTOR OPPORTUNITY: The calculator and fetcher classes are duplicated.
Could extract to shared 02_zone_system/common/ module.

================================================================================
TICKER VALIDATION RULES
================================================================================

validate_ticker() accepts:
  - 1-5 characters
  - Alphabetic only (A-Z)
  - Whitespace trimmed
  - Converted to uppercase

Rejects:
  - Empty/None values
  - Numbers in ticker
  - Special characters
  - Tickers > 5 chars

================================================================================
COMMON MODIFICATION SCENARIOS
================================================================================

Expand to more than 10 tickers:
  -> epoch_ticker_structure_config.py: Extend TICKER_INPUT_ROWS, TICKER_ROWS

Allow numeric tickers (e.g., warrants):
  -> epoch_ticker_structure_config.py: Modify validate_ticker()

Change input column:
  -> ticker_structure_runner.py: read_ticker_list() cell reference
  -> epoch_ticker_structure_config.py: Update column mappings if needed

Share calculator with Module 01:
  -> Extract MarketStructureCalculator to common module
  -> Update imports in both runners

================================================================================
END OF DOCUMENTATION
================================================================================