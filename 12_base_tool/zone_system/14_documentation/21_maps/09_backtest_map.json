{
  "_comment": "Epoch Trading System - Module 09: Backtest Cell Map",
  "_version": "2.3",
  "_organization": "XIII Trading LLC",
  "_module": "09_backtest",
  "_description": "Cell mappings for end-of-day backtesting system (EPCH1-4 entry models)",
  "_directory": "02_zone_system/09_backtest/",

  "input_worksheets": {
    "zone_results": "zone_results",
    "analysis": "Analysis",
    "market_overview": "market_overview"
  },

  "output_worksheet": "backtest",

  "zone_results_input": {
    "_description": "Filtered L2-L5 zones from Module 06",
    "columns": {
      "ticker_id": "A",
      "ticker": "B",
      "date": "C",
      "price": "D",
      "direction": "E",
      "zone_id": "F",
      "hvn_poc": "G",
      "zone_high": "H",
      "zone_low": "I",
      "overlaps": "J",
      "score": "K",
      "rank": "L",
      "confluences": "M",
      "epch_bull": "N",
      "epch_bear": "O",
      "epch_bull_price": "P",
      "epch_bear_price": "Q",
      "epch_bull_target": "R",
      "epch_bear_target": "S"
    }
  },

  "analysis_input": {
    "_description": "Primary and secondary setups from Module 07",
    "primary_section": {
      "_rows": "31-40",
      "columns": {
        "ticker": "B",
        "direction": "C",
        "ticker_id": "D",
        "zone_id": "E",
        "hvn_poc": "F",
        "zone_high": "G",
        "zone_low": "H",
        "target_id": "I",
        "target": "J",
        "r_r": "K"
      }
    },
    "secondary_section": {
      "_rows": "31-40",
      "columns": {
        "ticker": "M",
        "direction": "N",
        "ticker_id": "O",
        "zone_id": "P",
        "hvn_poc": "Q",
        "zone_high": "R",
        "zone_low": "S",
        "target_id": "T",
        "target": "U",
        "r_r": "V"
      }
    },
    "setup_strings": {
      "_rows": "44-53",
      "columns": {
        "ticker": "B",
        "setup_string": "C"
      }
    }
  },

  "market_overview_input": {
    "_description": "Composite direction for primary/secondary assignment",
    "ticker_structure": {
      "_rows": "36-45",
      "columns": {
        "composite": "R"
      }
    }
  },

  "backtest_output": {
    "_description": "Trade log output (v2.3 format with trade_id)",
    "header_row": 1,
    "data_start_row": 2,
    "trade_log_columns": {
      "trade_id": "A",
      "date": "B",
      "ticker": "C",
      "model": "D",
      "zone_type": "E",
      "direction": "F",
      "zone_high": "G",
      "zone_low": "H",
      "entry_price": "I",
      "entry_time": "J",
      "stop_price": "K",
      "target_3r": "L",
      "target_calc": "M",
      "target_used": "N",
      "exit_price": "O",
      "exit_time": "P",
      "exit_reason": "Q",
      "pnl_dollars": "R",
      "pnl_r": "S",
      "risk": "T",
      "win": "U"
    },
    "summary_start_column": "W",
    "column_types": {
      "trade_id": "string",
      "date": "date",
      "ticker": "string",
      "model": "string",
      "zone_type": "string",
      "direction": "string",
      "zone_high": "float",
      "zone_low": "float",
      "entry_price": "float",
      "entry_time": "time",
      "stop_price": "float",
      "target_3r": "float",
      "target_calc": "float",
      "target_used": "float",
      "exit_price": "float",
      "exit_time": "time",
      "exit_reason": "string",
      "pnl_dollars": "float",
      "pnl_r": "float",
      "risk": "float",
      "win": "integer"
    }
  },

  "trade_id_format": {
    "_description": "Unique trade identifier format",
    "format": "{ticker}_{MMDDYY}_{model}_{HHMM}",
    "examples": [
      "LLY_120925_EPCH2_1450",
      "AVGO_120925_EPCH1_0935",
      "AMZN_120925_EPCH3_1115"
    ]
  },

  "entry_models": {
    "EPCH1": {
      "zone_type": "PRIMARY",
      "entry_type": "Continuation",
      "description": "Price traverses through primary zone"
    },
    "EPCH2": {
      "zone_type": "PRIMARY",
      "entry_type": "Rejection",
      "description": "Price rejects from primary zone"
    },
    "EPCH3": {
      "zone_type": "SECONDARY",
      "entry_type": "Continuation",
      "description": "Price traverses through secondary zone"
    },
    "EPCH4": {
      "zone_type": "SECONDARY",
      "entry_type": "Rejection",
      "description": "Price rejects from secondary zone"
    }
  },

  "exit_types": {
    "STOP": "Stop loss triggered (zone boundary + $0.05)",
    "TARGET_3R": "3R target hit",
    "TARGET_CALC": "Calculated target hit",
    "CHOCH": "Change of Character exit (M5 structure reversal)",
    "EOD": "End of Day forced exit (15:50 ET)"
  },

  "exit_priority": {
    "1": "STOP - M5 close beyond zone boundary stop",
    "2": "TARGET - max(Calc Target, 3R) for longs, min for shorts",
    "3": "CHOCH - M5 market structure reversal",
    "4": "EOD - Force close at 15:50 ET"
  },

  "stop_placement": {
    "LONG": "zone_low - $0.05",
    "SHORT": "zone_high + $0.05",
    "buffer": 0.05
  },

  "target_calculation": {
    "3R_target_long": "entry_price + (risk × 3)",
    "3R_target_short": "entry_price - (risk × 3)",
    "calc_target": "From Analysis worksheet (Module 07)",
    "target_used_long": "max(3R, calc) if calc > entry, else 3R",
    "target_used_short": "min(3R, calc) if calc < entry, else 3R"
  },

  "trading_session": {
    "entry_start_time": "09:30",
    "entry_end_time": "15:30",
    "force_exit_time": "15:50",
    "timezone": "America/New_York"
  },

  "configuration_parameters": {
    "stop_buffer": 0.05,
    "target_r_multiple": 3,
    "use_choch_exit": true,
    "fractal_length": 5,
    "max_lookback_bars": 50,
    "api_delay": 0.25,
    "api_retries": 3
  },

  "summary_statistics": {
    "_description": "Summary section starting at column W",
    "overall": ["total_trades", "wins", "losses", "win_rate", "gross_profit", "gross_loss", "net_pnl", "profit_factor"],
    "r_based": ["total_r", "avg_win_r", "avg_loss_r", "expectancy"],
    "by_model": "Trades, Win Rate, Net R per model (EPCH1-4)",
    "by_exit_type": "Count, Win Rate, Net R per exit (STOP, TARGET_3R, TARGET_CALC, CHOCH, EOD)"
  },

  "cell_reference_examples": {
    "first_trade_id": "A2",
    "first_ticker": "C2",
    "first_entry_price": "I2",
    "first_pnl_r": "S2",
    "summary_start": "W2"
  }
}
